conda {
    enabled = true
    cacheDir = '/data/project/worthey_lab/tools/nextflow/nextflow-conda-env-cache/'
}

// Define the Scratch directory
def scratch_dir = System.getenv("USER_SCRATCH") ?: "/tmp"

params {
    config_profile_name = 'cheaha'
    config_profile_description = 'University of Alabama at Birmingham Cheaha HPC'
    config_profile_contact = 'Tarun Mamidi (tmamidi@uab.edu)'
}

env {
    TMPDIR="$scratch_dir"
    SINGULARITY_TMPDIR="$scratch_dir"
}

singularity {
    enabled = true
    autoMounts = true
    runOptions = "--contain --workdir $scratch_dir"
}

process {
    executor = 'slurm'

    // withName: extractFromVCF {
    //    cpus = 1
    //    memory = 1.GB
    //    queue = 'express'
    //}
    withName: runOC {
        cpus = 6
        memory = 15.GB
        time = 100.h
        queue = 'amd-hdr100-res'
        clusterOptions = '--reservation=wortheylab'
    }
    withName: parseAnnotation {
        cpus = 1
        memory = 1.GB
        time = 2.h
        queue = 'amd-hdr100-res'
        clusterOptions = '--reservation=wortheylab'
    }
    withName: prediction {
        cpus = 1
        memory = 4.GB
        time = 2.h
        queue = 'amd-hdr100-res'
        clusterOptions = '--reservation=wortheylab'
    }

    errorStrategy = 'retry'
    maxRetries = 2
    beforeScript = 'module load Singularity'
}

params {
    max_memory = 3072.GB
    max_cpus = 264
}

// https://www.nextflow.io/docs/latest/config.html#scope-executor
executor {
    name = 'slurm'
    submitRateLimit = '10/1sec'
    pollInterval = '120 sec'

    queueSize = 1536
}

// cleanup = 'eager'
